{% extends 'base.html' %}

{% block content %}

<div class='Qs'>
    <h3>{{ question.title }}
        <a id="toggle-starred" data-question-id="{{ question.pk }}" style="cursor: pointer">
            {% if question.isStarred %}
            &#9733;
            {% else %}
            &#9734;
            {% endif %}
        </a>
    </h3>

    <p>{{ question.body }}</p>

    <p>Asked at: {{ question.niceAsked }}</p>
</div>

<div class='As'>
    {% for answer in answers %}
    <div class='answer'>
        <p class='Abody'>
            {{ answer.body }}

        </p>
        <p class='Aauthor'>Written by {{ answer.author }} on {{ answer.niceAnswered }}</p>

        <a id="{{ answer.pk }}" data-answer-id="{{ answer.pk }}" style="cursor: pointer">
            {% if answer.isStarred %}
            &#9733;
            {% else %}
            &#9734;
            {% endif %}

            <script>
                var toggle = node.parentElement.parentElement
                toggle.addEventListener('click', function (e) {
                    e.preventDefault()
                    var answerId = toggle.dataset['answerId']
                    fetch(`/answer/${answerId}/starred/`, {
                        method: 'POST'
                    })
                        .then(res => res.json())
                        .then(data => {
                            if (data.starred) {
                                toggle.innerHTML = '&#9733;'
                            } else {
                                toggle.innerHTML = '&#9734;'
                            }
                        })

                })
            </script>
        </a>



    </div>
    {% endfor %}
</div>


{% if user.is_authenticated %}
<button id='answerbtn'>
    <h3>Have an answer?</h3>
</button>


<form id="answerBox" method="POST" style="display: none;">
    {% csrf_token %}

    {{ form.as_p}}
    <input type='submit' value='Submit Answer'>
</form>

{% endif %}


<div class='qButtons'>
    <button><a href="{% url 'frontpage' %}">Back to Front Page</a></button>

    {% if question.user == request.user %}
    <button><a href="{% url 'question_delete' pk=question.pk %}">Delete Question</a></button>
    {% endif %}
</div>


<script>
    function answerBox() {
        var x = document.querySelector('#answerBox');
        if (x.style.display === 'none') {
            x.style.display = 'block';
        } else {
            x.style.display = 'none';
        }
    }

    var btn = document.querySelector('#answerbtn')
    btn.addEventListener("click", answerBox)



    const toggleStarredLink = document.querySelector("#toggle-starred")
    toggleStarredLink.addEventListener('click', function (e) {
        e.preventDefault()
        const questionId = toggleStarredLink.dataset['questionId']
        fetch(`/question/${questionId}/starred/`, {
            method: 'POST'
        })
            .then(res => res.json())
            .then(data => {
                if (data.starred) {
                    toggleStarredLink.innerHTML = '&#9733;'
                } else {
                    toggleStarredLink.innerHTML = '&#9734;'
                }
            })

    })



</script>


{% endblock %}